<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../app/profile_style.css">
    <title>Home</title>
    <!-- DATABASE CONNECTION DON'T TOUCH -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

</head>  
<body>

    <h1 id="mentee-header">My Mentees</h1>
    <div>
        <ul id="userMenteeList">
            
        </ul>
    </div>

    <h1 id="mentee-header">Available Mentees</h1>
    <div>
        <ul id="availableMenteeList">
            
        </ul>
    </div>
    <button><a href="../app/profile.html">Back to My Profile</a></button>
      

</body>
<script>
    console.log("STARTING DB CONNECTION");
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyB9PV7cvxg6wblks33WezXvmHkUbo9cPno",
        authDomain: "goal-master-93ae0.firebaseapp.com",
        projectId: "goal-master-93ae0",
        storageBucket: "goal-master-93ae0.appspot.com",
        messagingSenderId: "793578125991",
        appId: "1:793578125991:web:34e09bfa84476011db7982"
    };
    //Initating Database Connection -- DO NOT REMOVE
    const app = firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore(app);

    app.auth().onAuthStateChanged((user) => {
        if (user) {
            // User is signed in, see docs for a list of available properties
            // https://firebase.google.com/docs/reference/js/firebase.User
            console.log("USER SIGNED IN AS : " + user.uid);           
        } //end if statement for user sign in 
        else {
            console.log("USER IS SIGNED OUT, REDIRECTING TO LOGIN PAGE...");
            window.location.href = "../auth/login.html"
            // User is signed out
            // ...
        }
    });

    function loadList(){
        var group = []
        db.collection("user_info").where("role", "==", "Mentee").get().then((querySnapshot) =>
        {
            querySnapshot.forEach((doc) => {
                console.log(doc.id, " => ", doc.data());
                var ul = document.getElementById("availableMenteeList");
                if(!doc.data().UID || doc.data().UID == ""){
                    var li = document.createElement("li");
                    var link = document.createElement('a');
                    link.href = "../app/profile.html?pid=" + doc.id;
                    link.innerText = doc.data().firstName + " " + doc.data().lastName;
                    li.appendChild(link);
                    
                    var addButton = document.createElement("button");
                    addButton.innerText = "Add"
                    addButton.style = "margin-left: 15px;margin-top: 10px;width: fit-content;font-size: 14px;"
                    addButton.setAttribute("onclick", 'addUserToMenteeList("' + doc.id + '");')
                    li.appendChild(addButton);
                    
                    ul.appendChild(li);
                }
            });
           // }
        });
        app.auth().onAuthStateChanged((user) => {
            db.collection("user_info").where("UID", "==", user.uid).get().then((querySnapshot) =>
            {
                querySnapshot.forEach((doc) => {
                    console.log(doc.id, " => ", doc.data());
                    var ul2 = document.getElementById("userMenteeList");
                    var li2 = document.createElement("li");
                    var link2 = document.createElement('a');
                    link2.href = "../app/profile.html?pid=" + doc.id;
                    link2.innerText = doc.data().firstName + " " + doc.data().lastName;
                    li2.appendChild(link2);
                    
                    ul2.appendChild(li2);
                });
            // }
            });
        });
    }

    function addUserToMenteeList(menteeUID) {
        app.auth().onAuthStateChanged((user) => {
            // User is signed in, see docs for a list of available properties
            // https://firebase.google.com/docs/reference/js/firebase.User
            console.log("USER SIGNED IN AS : " + user.uid);  
            db.collection("user_info").doc(menteeUID).update({
                UID: user.uid
            })
            .then(() => {
                location.reload();
            })
        });
    }
    loadList()

    //***Waiting for Authentication in order to Implement Full***
    // Initialize Firebase
    // console.log("INITIALIZED FIREBASE");

    // function userSignIn(email, password){
    //   app.auth().signInWithEmailAndPassword(email, password)
    //   .then((userCredential) => {
    //       // Signed in
    //       console.log("Sign In Success!");
    //       window.location.href="../app/profile.html"
    //   })
    //   .catch((error) => {
    //     errPgrph = document.getElementById('error');
    //     errPgrph.innerHTML = error.message;
    //   })
    // }

    // Function to GET list of all Mentors Mentees
    </script>
</html>
